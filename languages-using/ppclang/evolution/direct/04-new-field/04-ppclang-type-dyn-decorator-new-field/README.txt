В данной версии добавляется декоратор, который отвечает за цвет фигуры. Помимо этого он имеет обобщенный указатель на другую фигуру, что обеспечивает его динамическое связывание со специализацией.
Сам декоратор тоже является одной из специализаций фигуры.
То есть, рассматриваемое решение реализовано аналогично декоратору ОО подхода.
Это не является удачным решением с точки зрения ППП, так как там декорируемые конструкции можно строить более эффективно.

!!! Пока еще не реализована корректно очистка памяти. Скорее всего для удаления цепочек нужно будет писать пользовательскую функцию, делающую удаление цепочки.